<?php
if (!defined('__GOOSE__')) exit();

$titleType = ($this->param['action'] == 'modify') ? '수정' : '만들기';
$nestName = ($repo['nest']['name']) ? '<em class="gs-brk-type">'.$repo['nest']['name'].'</em> ' : '';
$extPath = __GOOSE_ROOT__.'ext/';

$file = Module::load('file');
?>

<!--<link rel="stylesheet" href="<?= $extPath.'UploadInterface/UploadInterface.css' ?>">-->
<link rel="stylesheet" href="<?= __GOOSE_ROOT__.$this->skinPath.'css/UploadInterface.css' ?>">
<link rel="stylesheet" href="<?= $extPath.'Jcrop/jquery.Jcrop.css' ?>">
<link rel="stylesheet" href="<?= $extPath.'Parsedown/markdown.css' ?>" />
<link rel="stylesheet" href="<?= __GOOSE_ROOT__.$this->skinPath.'css/slide.css' ?>">

<section>
	<div class="gs-headding">
		<h1>
			<span><?=$nestName?>문서<?=$titleType?></span>
			<a href="<?=__GOOSE_ROOT__?>help/article/" class="icn-help" title="go to help"></a>
		</h1>
		<p><?=$this->set['description']?></p>
	</div>

	<form name="writeForm" action="<?=__GOOSE_ROOT__.'article/'.$this->param['action'].'/'?>" method="post" enctype="multipart/form-data">
		<input type="hidden" name="app_srl" value="<?=$repo['nest']['app_srl']?>" />
		<input type="hidden" name="nest_srl" value="<?=$repo['nest']['srl']?>" />
		<input type="hidden" name="article_srl" value="<?=$article_srl?>" />
		<input type="hidden" name="skin" value="<?=$repo['nest']['json']['articleSkin']?>" />
		<input type="hidden" name="page" value="<?=$_GET['page']?>" />
		<input type="hidden" name="json" value="" />
		<input type="hidden" name="m" value="<?=$_GET['m']?>" />
		<input type="hidden" name="addQueue" />
		<input type="hidden" name="thumnail_image" />
		<input type="hidden" name="content" value="<?=$repo['article']['content']?>"/>

		<fieldset class="form-group">
			<?php
			if (count($repo['category']))
			{
				?>
				<dl class="gs-webz">
					<dt><label for="category">분류</label></dt>
					<dd>
						<select name="category_srl" id="category">
							<option value="">분류선택</option>
							<?php
							foreach($repo['category'] as $k=>$v)
							{
								$selected = ($repo['article']['category_srl']==$v['srl'] || $category_srl==$v['srl']) ? ' selected' : '';
								echo "<option value='$v[srl]'$selected>$v[name]</option>";
							}
							?>
						</select>
					</dd>
				</dl>
			<?php
			}
			?>

			<dl class="gs-webz">
				<dt><label for="title">제목</label></dt>
				<dd><input type="text" id="title" name="title" class="block" value="<?=$repo['article']['title']?>" /></dd>
			</dl>

			<dl>
				<dt><label for="title">파일첨부</label></dt>
				<dd>
					<div>
						<input type="file" name="fileUpload" id="fileUpload" multiple />
						<button type="button" id="fileUploadButton">업로드</button>
					</div>
					<div class="queuesManager" id="queuesManager" style="margin-top:8px"></div>
				</dd>
			</dl>
		</fieldset>

		<nav class="gs-btn-group right">
			<button type="submit" class="gs-button col-key"><?=$titleType?></button>
			<button type="button" class="gs-button" onclick="history.back(-1)">뒤로가기</button>
		</nav>
	</form>
</section>

<script src="<?= $extPath.'Jcrop/jquery.Jcrop.min.js' ?>"></script>
<script src="<?= $extPath.'dragsort/jquery.dragsort-0.5.1.min.js' ?>"></script>
<script src="<?= $extPath.'UploadInterface/FilesQueue.class.min.js' ?>"></script>
<script src="<?= $extPath.'UploadInterface/FileUpload.class.min.js' ?>"></script>
<script src="<?= $extPath.'UploadInterface/Thumnail.class.min.js' ?>"></script>
<script src="<?= $extPath.'UploadInterface/UploadInterface.class.min.js' ?>"></script>
<script src="<?=__GOOSE_ROOT__.$this->skinPath.'js/uploadInterface_edit.min.js'?>"></script>
<script>
var userData = {
	root : '<?=__GOOSE_ROOT__?>'
	,url : '<?=__GOOSE_URL__?>'
	,thumnail : {
		type : '<?=$repo['nest']['json']['thumnail']['type']?>'
		,size : '<?=$repo['nest']['json']['thumnail']['size'][0].'*'.$repo['nest']['json']['thumnail']['size'][1]?>'
		,srl : '<?=$repo['article']['json']['thumnail']['srl']?>'
		,coords : '<?=$repo['article']['json']['thumnail']['coords']?>'
		,url : '<?=$repo['article']['json']['thumnail']['url']?>'
	}
	,originalPath : '<?=$file->set['upPath_original']?>/'
	,pushData : '<?=require_once(__DIR__.'/../markdown/attachFiles.php');?>'
};
</script>
<script src="<?=__GOOSE_ROOT__.$this->skinPath.'js/slide.min.js'?>"></script>