<!doctype html>
<?php
if (!defined('__GOOSE__')) exit();

$apikeyPrefix = '__' . core\Util::generateRandomString(15) . '__';
?>

<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>Install Goose</title>
<link rel="stylesheet" href="<?=__GOOSE_ROOT__.'/'.$this->skinPath?>css/layout.css" />
</head>
<body>
<main>
	<header>
		<h1>Install Goose</h1>
		<?php
		if (version_compare(PHP_VERSION, __GOOSE_MIN_PHP_VERSION__, '<'))
		{
			echo "<p class=\"error\">".__GOOSE_MIN_PHP_VERSION__ . '이상의 PHP버전이 설치되어있어야합니다.<br>현재버전:' . PHP_VERSION."</p>";
		}
		?>
	</header>

	<form action="<?=__GOOSE_ROOT__?>/" method="post" id="regsterForm">
		<fieldset>
			<legend>Location</legend>
			<label>
				<strong>Relative url</strong>
				<span><input type="text" name="goose_root" id="goose_root" size="45" maxlength="255" value="<?=__GOOSE_ROOT__?>" /></span>
			</label>
			<label>
				<strong>Install url</strong>
				<span><input type="text" name="goose_url" id="goose_url" size="45" maxlength="255" value="<?='http://'.$_SERVER['HTTP_HOST'].__GOOSE_ROOT__?>" /></span>
			</label>
		</fieldset>
		<fieldset>
			<legend>Database infomation</legend>
			<label>
				<strong>DB user id</strong>
				<span><input type="text" name="dbId" id="dbId" size="15" maxlength="20" /></span>
			</label>
			<label>
				<strong>DB password</strong>
				<span><input type="password" name="dbPassword" size="15" id="dbPassword" maxlength="20" /></span>
			</label>
			<label>
				<strong>DB confirm password</strong>
				<span><input type="password" name="dbPassword2" size="15" id="dbPassword2" maxlength="20" /></span>
			</label>
			<label>
				<strong>DB name</strong>
				<span><input type="text" name="dbName" id="dbName" size="15" maxlength="20" /></span>
			</label>
			<hr />
			<label>
				<strong>DB hostname</strong>
				<span><input type="text" name="dbHost" id="dbHost" size="12" maxlength="40" value="localhost" /></span>
			</label>
			<label>
				<strong>DB port</strong>
				<span><input type="text" name="dbPort" id="dbPort" size="5" maxlength="5" value="3306" /></span>
			</label>
			<label>
				<strong>Table name prefix</strong>
				<span><input type="text" name="dbPrefix" id="dbPrefix" size="12" maxlength="20" value="goose_" /></span>
			</label>
		</fieldset>

		<fieldset>
			<legend>Admin infomation</legend>
			<label>
				<strong>E-mail</strong>
				<span><input type="email" name="email" id="email" size="28" maxlength="40" /></span>
			</label>
			<label>
				<strong>Nickname</strong>
				<span><input type="text" name="name" id="name" size="18" maxlength="20" /></span>
			</label>
			<label>
				<strong>Password</strong>
				<span><input type="password" name="password" id="password" size="15" maxlength="20" /></span>
			</label>
			<label>
				<strong>Confirm password</strong>
				<span><input type="password" name="password2" id="password2" size="15" maxlength="20" /></span>
			</label>
			<label>
				<strong>접근가능한 레벨</strong>
				<span>
					<input type="text" name="loginLevel" id="loginLevel" size="6" maxlength="10" value="100" /><br/>
					<span>관리 페이지에 접근 가능한 사용자 레벨입니다.</span>
				</span>
			</label>
			<label>
				<strong>관리자 레벨</strong>
				<span>
					<input type="text" name="adminLevel" id="adminLevel" size="6" maxlength="10" value="100" /><br/>
					<span>모든 권한을 가지고 있는 관리자 레벨입니다.</span>
				</span>
			</label>
		</fieldset>

		<fieldset>
			<legend>API</legend>
			<label>
				<strong>API KEY prefix</strong>
				<span><input type="text" name="apiPrefix" id="apiPrefix" size="28" maxlength="20" value="<?=$apikeyPrefix?>" /></span>
			</label>
		</fieldset>

		<fieldset>
			<legend>ETC</legend>
			<label>
				<strong>Timezone</strong>
				<span>
					<input type="text" name="timezone" size="24" maxlength="30" value="Asia/Seoul" required /><br/>
					<span><a href="http://php.net/manual/en/timezones.php" target="_blank">List of Supported Timezones</a> 페이지에 있는 지역을 참고하여 해당지역을 입력해주세요.</span>
				</span>
			</label>
		</fieldset>
		<nav>
			<button type="submit">Install</button>
		</nav>
	</form>
</main>
<script src="<?=__GOOSE_ROOT__?>/vendor/jQuery/jquery-3.1.x.min.js"></script>
<script src="<?=__GOOSE_ROOT__?>/vendor/validation/jquery.validate.min.js"></script>
<script src="<?=__GOOSE_ROOT__?>/vendor/validation/localization/messages_ko.js"></script>
<script>
jQuery(function($){
	$('#regsterForm').validate({
		rules : {
			dbId : { required: true, minlength: 3 }
			,dbPassword : { required: true }
			,dbPassword2 : { equalTo: '#dbPassword' }
			,dbName : { required: true }
			,dbHost : { required: true }
			,dbPort : { required: true }
			,dbPrefix : { required: true }
			,email : { required: true }
			,name : { required: true }
			,password : { required: true }
			,password2 : { equalTo: '#password' }
			,apiPrefix : { required: true }
		}
	});
});
</script>
</body>
</html>
